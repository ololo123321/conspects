\documentclass[12pt]{article}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{derivative}

\begin{document}

\title{Derivative of scalar function w.r.t. arguments of matrix multiplication operation}
\author{Kadulin V.}
%\date{}
\maketitle

Let $A \in \mathbb{R}^{N \times D}$, $B \in \mathbb{R}^{D \times M}$, 
$f: \mathbb{R}^{N \times M} \rightarrow \mathbb{R}$ is a differentiable function, $C = AB$, $f(C) = y$. We also know $\pdv{y}{C}$. 

Derive $\pdv{y}{A}$, $\pdv{y}{B}$.

Let's make a simple example: $N = D = M = 2$. Then

\[
	A = 
	\begin{bmatrix} 
		a_0 & a_1 \\
		a_2 & a_3 \\
	\end{bmatrix},
	B = 
	\begin{bmatrix} 
		b_0 & b_1 \\
		b_2 & b_3 \\
	\end{bmatrix},
	C = 
	\begin{bmatrix} 
		c_0 & c_1 \\
		c_2 & c_3 \\
	\end{bmatrix}.
\]

\section{$\frac{\partial y}{\partial A}$}

\begin{enumerate}
\item Let's consider first row of $A = a$ and first column of $B = b$.  
Then $c_0 = a \cdot b = a_0b_0 + a_1b_2$ is a scalar.  
\[
	\pdv{y}{a_0} = 
	\pdv{y}{c_0} \pdv{c_0}{a_0} = 
	\pdv{y}{c_0} b_0
\]
\item Let's consider first row of $A = a$ and full matrix $B$.  
Then $
c = aB = 
\begin{bmatrix}c_0 & c_1\end{bmatrix} =
\begin{bmatrix}a_0b_0 + a_1b_2 & a_0b_1 + a_1b_3\end{bmatrix} 
$ is a row vector.  
\[
	\pdv{y}{a_0} = 
	\pdv{y}{c} \pdv{c}{a_0} = 
	\begin{bmatrix}
		\pdv{y}{c_0} & \pdv{y}{c_1}
	\end{bmatrix} 
	\begin{bmatrix} 
		b_0 & b_1
	\end{bmatrix} ^\top
\]
\end{enumerate}

Note that:

\begin{itemize}
\item left operand is i-th row in $\pdv{y}{C}$, $0 \le i < N$
\item right operand is transposed j-th row in $B$, $0 \le j < D$  
\end{itemize}

So, $\pdv{y}{A} = \pdv{y}{C} B^\top$.

\section{$\frac{\partial y}{\partial B}$}

\begin{enumerate}
\item Let's consider first row of $A = a$ and first column of $B = b$.  
Then $c_0 = a \cdot b = a_0b_0 + a_1b_2$ is a scalar.  
\[
	\pdv{y}{b_0} = 
	\pdv{y}{c_0} \pdv{c_0}{b_0} = 
	\pdv{y}{c_0} a_0
\]
\item Let's consider full matrix $A$ and first column of $B = b$.  
Then $
c = Ab = 
\begin{bmatrix}c_0 \\ c_2\end{bmatrix} =
\begin{bmatrix}a_0b_0 + a_1b_2 \\ a_2b_0 + a_3b_2\end{bmatrix}
$ is a column vector.  
\[
	\pdv{y}{b_0} = 
	\pdv{y}{c} \pdv{c}{b_0} = 
	\begin{bmatrix}
		\pdv{y}{c_0} \\ \pdv{y}{c_2}
	\end{bmatrix} ^\top	
	\begin{bmatrix} 
		a_0 \\ a_2
	\end{bmatrix} =
	\begin{bmatrix} 
		a_0 \\ a_2
	\end{bmatrix} ^\top
	\begin{bmatrix}
		\pdv{y}{c_0} \\ \pdv{y}{c_2}
	\end{bmatrix}
\] 
\end{enumerate}

Note that:

\begin{itemize}
\item left operand is transposed i-th column in $A$, $0 \le i < D$  
\item right operand is j-th column in $\pdv{y}{C}$, $0 \le j < M$  
\end{itemize}

So, $\pdv{y}{B} = A^\top \pdv{y}{C}$.

\end{document}